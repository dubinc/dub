enum FraudEventStatus {
  pending
  safe
  banned
}

enum FraudRiskLevel {
  high
  medium
  low
}

enum FraudRuleType {
  selfReferral
  bannedReferralDomain
  paidAdTrafficDetected
  customerEmailSuspiciousDomain
}

model FraudRule {
  id         String        @id @default(cuid())
  programId  String
  type       FraudRuleType
  config     Json?         @db.Json
  disabledAt DateTime?
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt

  program Program? @relation(fields: [programId], references: [id], onDelete: Cascade)

  @@unique([programId, type])
}

model FraudEvent {
  id               String           @id @default(cuid())
  programId        String
  partnerId        String
  linkId           String?
  customerId       String?
  eventId          String?          @unique
  commissionId     String?          @unique
  riskLevel        FraudRiskLevel
  riskScore        Int              @default(0)
  triggeredRules   Json             @db.Json
  userId           String?
  resolutionReason String?
  resolvedAt       DateTime?
  status           FraudEventStatus @default(pending)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  program    Program     @relation(fields: [programId], references: [id], onDelete: Cascade)
  partner    Partner     @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  customer   Customer?   @relation(fields: [customerId], references: [id])
  link       Link?       @relation(fields: [linkId], references: [id])
  commission Commission? @relation(fields: [commissionId], references: [id])
  user       User?       @relation(fields: [userId], references: [id])

  @@index(programId)
  @@index(partnerId)
  @@index(customerId)
  @@index(linkId)
  @@index(eventId)
  @@index(userId)
}
