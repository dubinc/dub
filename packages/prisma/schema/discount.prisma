model Discount {
  id           String          @id @default(cuid())
  programId    String
  amount       Int             @default(0)
  type         RewardStructure @default(percentage)
  maxDuration  Int? // in months (0 -> one-time purchase, 1, 3, 6, 12, 18, 24, 36Â -> months, null -> lifetime)
  description  String?
  couponId     String?
  couponTestId String?
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  programEnrollments ProgramEnrollment[]
  program            Program             @relation("ProgramDiscounts", fields: [programId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  partnerGroup       PartnerGroup?
  discountCodes      DiscountCode[]

  @@index(programId)
}

model DiscountCode {
  id         String   @id @default(cuid())
  code       String
  programId  String
  discountId String?
  partnerId  String
  linkId     String   @unique
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  program           Program            @relation(fields: [programId], references: [id])
  discount          Discount?          @relation(fields: [discountId], references: [id], onDelete: SetNull)
  partner           Partner            @relation(fields: [partnerId], references: [id])
  link              Link               @relation(fields: [linkId], references: [id])
  programEnrollment ProgramEnrollment? @relation(fields: [programId, partnerId], references: [programId, partnerId])

  @@unique([programId, code])
  @@index([programId, partnerId])
  @@index(discountId)
  @@index(partnerId)
}
