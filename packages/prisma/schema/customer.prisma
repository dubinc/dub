model Customer {
  id               String  @id @default(cuid())
  name             String?
  email            String?
  avatar           String? @db.Text
  externalId       String?
  stripeCustomerId String? @unique

  linkId    String?
  clickId   String?
  clickedAt DateTime?
  country   String?

  sales      Int @default(0)
  saleAmount Int @default(0)

  projectId        String
  projectConnectId String?

  programId String?
  partnerId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  project           Project            @relation(fields: [projectId], references: [id])
  link              Link?              @relation(fields: [linkId], references: [id])
  program           Program?           @relation(fields: [programId], references: [id], onDelete: Cascade)
  partner           Partner?           @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  programEnrollment ProgramEnrollment? @relation(fields: [programId, partnerId], references: [programId, partnerId])
  commissions       Commission[]
  fraudEvents       FraudEvent[]
  referrals         PartnerReferral[]

  @@unique([projectId, externalId])
  @@unique([projectConnectId, externalId])
  @@index([projectId, email])
  @@index([projectId, createdAt])
  @@index([projectId, saleAmount])
  @@index([programId, partnerId])
  @@index(linkId)
  @@index(country)
  @@fulltext([email, name]) // For full-text search
}
