enum MessageType {
  direct
  campaign
}

model Message {
  id        String @id @default(cuid())
  programId String
  partnerId String

  senderUserId    String
  senderPartnerId String? // Populated only if the sender is a partner

  type    MessageType @default(direct)
  subject String? // Only for Campaign
  text    String      @db.Text

  readInApp   DateTime?
  readInEmail DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  program           Program             @relation(fields: [programId], references: [id], onDelete: Cascade)
  partner           Partner             @relation(fields: [partnerId], references: [id], onDelete: Cascade)
  programEnrollment ProgramEnrollment   @relation(fields: [programId, partnerId], references: [programId, partnerId])
  senderUser        User                @relation(fields: [senderUserId], references: [id], onDelete: Cascade)
  senderPartner     Partner?            @relation("SenderPartner", fields: [senderPartnerId], references: [id], onDelete: Cascade)
  emails            NotificationEmail[]

  @@index([programId, partnerId])
  @@index(partnerId)
  @@index(senderPartnerId)
  @@index(senderUserId)
}
