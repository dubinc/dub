enum CampaignType {
  marketing
  transactional
}

enum CampaignStatus {
  draft

  // Transactional
  active
  paused

  // Marketing
  scheduled
  sending
  sent
  canceled
}

model Campaign {
  id              String              @id @default(cuid())
  programId       String
  workflowId      String?             @unique
  userId          String
  qstashMessageId String?             @unique
  type            CampaignType
  status          CampaignStatus      @default(draft)
  name            String
  subject         String
  from            String?
  bodyJson        Json                @db.Json
  scheduledAt     DateTime?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  program         Program             @relation(fields: [programId], references: [id])
  workflow        Workflow?           @relation(fields: [workflowId], references: [id], onDelete: Cascade)
  groups          CampaignGroup[]
  emails          NotificationEmail[]

  @@index(programId)
}

model CampaignGroup {
  id         String @id @default(cuid())
  campaignId String
  groupId    String

  campaign     Campaign     @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  partnerGroup PartnerGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([campaignId, groupId])
  @@index(groupId)
}
