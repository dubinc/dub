enum PartnerRole {
  owner
  member
}

enum PartnerProfileType {
  individual
  company
}

enum MonthlyTraffic {
  ZeroToOneThousand
  OneThousandToTenThousand
  TenThousandToFiftyThousand
  FiftyThousandToOneHundredThousand
  OneHundredThousandPlus
}

enum PartnerPayoutMethod {
  connect
  stablecoin
  paypal
}

model Partner {
  id          String             @id @default(cuid())
  name        String
  companyName String?
  profileType PartnerProfileType @default(individual)
  email       String?            @unique
  image       String?
  description String?            @db.Text
  country     String?

  // payout fields
  paypalEmail                  String?              @unique
  stripeConnectId              String?              @unique
  stripeRecipientId            String?              @unique
  payoutsEnabledAt             DateTime?
  payoutMethodHash             String?
  payoutWalletAddress             String?
  connectPayoutsLastRemindedAt DateTime?
  defaultPayoutMethod          PartnerPayoutMethod?

  // timestamp fields
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  discoverableAt DateTime?
  trustedAt      DateTime?

  // miscellaneous fields
  invoiceSettings  Json?
  changeHistoryLog Json?

  programs                   ProgramEnrollment[]
  users                      PartnerUser[]
  invites                    PartnerInvite[]
  customers                  Customer[]
  payouts                    Payout[]
  commissions                Commission[]
  bountySubmissions          BountySubmission[]
  postbacks                  Postback[]
  messages                   Message[]
  sentMessages               Message[]                          @relation("SenderPartner")
  comments                   PartnerComment[]
  discountCodes              DiscountCode[]
  notificationEmails         NotificationEmail[]
  monthlyTraffic             MonthlyTraffic?
  industryInterests          PartnerIndustryInterest[]
  preferredEarningStructures PartnerPreferredEarningStructure[]
  salesChannels              PartnerSalesChannel[]
  discoveredByPrograms       DiscoveredPartner[]
  fraudEventGroups           FraudEventGroup[]
  fraudEvents                FraudEvent[]
  partnerRewinds             PartnerRewind[]
  platforms                  PartnerPlatform[]
  referrals                  PartnerReferral[]

  @@index(country)
  @@index(discoverableAt)
  @@index(trustedAt)
  @@index(payoutMethodHash)
  @@fulltext([email, name, companyName]) // For full-text search
}

model PartnerInvite {
  email     String
  expires   DateTime
  partnerId String
  role      PartnerRole @default(member)
  createdAt DateTime    @default(now())

  partner Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([email, partnerId])
  @@index(partnerId)
}

model PartnerUser {
  id        String      @id @default(cuid())
  role      PartnerRole @default(member)
  userId    String
  partnerId String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  partner Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  notificationPreferences PartnerNotificationPreferences?

  @@unique([userId, partnerId])
  @@index(partnerId)
}

model PartnerIndustryInterest {
  partnerId        String
  industryInterest IndustryInterest

  partner Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, industryInterest])
}

enum PreferredEarningStructure {
  Revenue_Share
  Per_Lead
  Per_Sale
  Per_Click
  One_Time_Payment
}

model PartnerPreferredEarningStructure {
  partnerId                 String
  preferredEarningStructure PreferredEarningStructure

  partner Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, preferredEarningStructure])
}

enum SalesChannel {
  Blogs
  Coupons
  Direct_Reselling
  Newsletters
  Social_Media
  Events
  Company_Referrals
}

model PartnerSalesChannel {
  partnerId    String
  salesChannel SalesChannel

  partner Partner @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  @@unique([partnerId, salesChannel])
}